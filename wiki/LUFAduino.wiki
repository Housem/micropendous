#summary Run Arduino code on a Micropendous
#labels Featured

The latest version of this firmware is available in the latest [http://code.google.com/p/micropendous/downloads/list Micropendous Distribution] or via [http://code.google.com/p/micropendous/source/checkout SVN] in the `/Micropendous/Firmware/LUFAduino` directory.

*Purpose:*  [http://www.arduino.cc/ Arduino] is a popular physical computing platform with a [http://en.wikipedia.org/wiki/Arduino C/C++-based] API that simplifies programming of microcontrollers.  LUFAduino combines the [http://www.fourwalledcubicle.com/LUFA.php LUFA] USB library, the [http://www.arduino.cc/ Arduino] library, and the preemptive [http://www.freertos.org/ FreeRTOS] kernel to enable programming Micropendous boards in Arduino code.  All USB functionality is hidden and USB Virtual Serial behaves like standard Serial on an Arduino board.  The preemptive FreeRTOS kernel allows the use of delays without interfering with USB functionality.  It also allows for multiple `loop()`s and multitasking.

*Source Code:* [http://code.google.com/p/micropendous/source/browse/trunk/Micropendous/Firmware/LUFAduino View] or [http://www.Micropendous.org/Distribution Download]

*Targets:* [Micropendous2], [Micropendous3], or [Micropendous4], or other USB AVR boards with more than 2kbytes of SRAM.

*USB Mode:* Device-mode enumerating as USB Virtual Serial

*Status:* _Under Development_.  Serial, pin definitions, digitalIn/Out, and analogOut are functional.  Please help out by posting any problems you encounter to the [http://groups.google.com/group/Micropendous Micropendous Group].

= Usage =

Assuming you have completed all setup tasks in the [QuickStart] tutorial, simply compile and upload the LUFAduino firmware onto your Micropendous using the process found in  [ProgramAndTest].

Note: run *make*, then *make flip* _(Windows)_ or *make dfu* _(Linux)_ to compile and load this firmware onto your Micropendous board.  Need to run *make* twice.
{{{
make
make
make flip
}}}

LUFAduino-programmed devices will enumerate as a Virtual Serial Port and any data sent to the device will be echoed back.  Pin 0 (PD0) will flash a LED connected to GND (remember to use a resistor or your LED may burn out).

= Firmware Design =

Arduino `loop()` and `setup()` functions are in `Sketch.cxx`.  Simply edit this file with your custom code using any code editor.  Under Windows, _Programmers Notepad_ comes with _WinAVR_ and is very useful.  See [SettingUpProgrammersNotepad] for setup instructions.

`loop1()` - sends any data received over the USB Virtual Serial connection back to the host.


`loop2()` - flashes a LED using `analogOut()`.

Simply edit either or both of the `loop()`s for your project.

For detailed firmware design, see [USBVirtualSerial_FreeRTOS] for details of how FreeRTOS was added and [USBVirtualSerial] for details about LUFA USB.

= Pinouts =

=== [Micropendous2] ===
http://micropendous.googlecode.com/svn/trunk/Micropendous/Design/Micropendous2/Micropendous2_LUFAduino-Pinout.jpg

=== [Micropendous2_JTAG Micropendous2-JTAG] ===
http://micropendous.googlecode.com/svn/trunk/Micropendous/Design/Micropendous2-JTAG/Micropendous2-JTAG_LUFAduino-Pinout.jpg

=== [Micropendous3] ===
http://micropendous.googlecode.com/svn/trunk/Micropendous/Design/Micropendous3/Micropendous3_LUFAduino-Pinout.jpg

=== [Micropendous4] ===
Note that external SRAM requires at least pin PE6 to be high to disable SRAM.  If your application makes use of external SRAM, do not use Ports A, C, and PortE pins 0,1,2,6,7.  For more info refer to [SRAMUsage].

http://micropendous.googlecode.com/svn/trunk/Micropendous/Design/Micropendous4/Micropendous4_LUFAduino-Pinout.jpg